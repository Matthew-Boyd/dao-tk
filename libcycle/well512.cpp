#include "well512.h"
#include <random>
#include <strstream>
#include <fstream>

/* 

Alex Zolan
March 30, 2017
WELL512a random number generator

This is an implementation of the WELL512a RNG created by L'Ecuyer and 
Matsumoto, originally programmed in C.  The states were taken from 
the SSJ library in Java.

converted from python back to c++ : mike wagner
*/

//WELLFiveTwelve::WELLFiveTwelve(){}

WELLFiveTwelve::WELLFiveTwelve(int scen, int W, int R, int P, int M1, int M2, int M3)
{
    this->W = W;
    this->R = R;
    this->P = P;
    this->M1 = M1;
    this->M2 = M2;
    this->M3 = M3;
    FACT = 2.32830643653869628906e-10;

    assignStates(scen);

}

int WELLFiveTwelve::V0()
{
    return state_i;
}

int WELLFiveTwelve::VM1()
{
    return (state_i + M1) & 0x0000000f;
}

int WELLFiveTwelve::VM2()
{
    return (state_i + M2) & 0x0000000f;
}

int WELLFiveTwelve::VM3()
{
    return (state_i + M3) & 0x0000000f;
}

int WELLFiveTwelve::VRm1()
{
    return (state_i + 15) & 0x0000000f;
}

int WELLFiveTwelve::VRm2()
{
    return (state_i + 14) & 0x0000000f;
}

int WELLFiveTwelve::newV0()
{
    return VRm1();
}

int WELLFiveTwelve::newV1()
{
    return state_i;
}

int WELLFiveTwelve::newVRm1()
{
    return (state_i + 14) & 0x0000000f;
}

uint32_t WELLFiveTwelve::MAT0POS(int t, uint32_t v)
{
    return (uint32_t)(v^(v>>t));
}

uint32_t WELLFiveTwelve::MAT0NEG(int t, uint32_t v)
{
    return (uint32_t)(v^(v<<(-(t))));
}

uint32_t WELLFiveTwelve::MAT3NEG(int t, uint32_t v)
{
    return (uint32_t)(v<<(-(t)));
}

uint32_t WELLFiveTwelve::MAT4NEG(int t, uint32_t b, uint32_t v)
{
    return (uint32_t)( v ^ ((v<<(-(t))) & b) );
}

double WELLFiveTwelve::getVariate()
{
    uint32_t z0 = state[VRm1()];
    uint32_t z1 = MAT0NEG(-16, V0()) ^ MAT0NEG(-15, state[VM1()]);
    uint32_t z2 = MAT0POS(11, state[VM2()]);
    state[newV1()] = z1 ^ z2;
    state[newV0()] = MAT0NEG(-2, z0) ^ MAT0NEG(-18, z1) ^ MAT3NEG(-28, z2) ^ MAT4NEG(-5, 0xda442d24, state[newV1()] );
    state_i = (state_i + 15) & 0x0000000f;
    return state[state_i] * FACT;
}


void WELLFiveTwelve::assignStates(int scenario)
{
	if (m_stored_states.find(scenario) == m_stored_states.end())
	{
		std::vector< std::vector< uint32_t > > D = {
			{ 2738995098,2950991899,1796267544,100537376,3834321564,1493885278,3320545959,938128121,2430715626,988166402,1935526172,2418948748,1823640157,2222254033,2218656163,1517514991 },
			{ 2291298232,798566220,2653105670,2535453878,1363162013,2834972182,4102415542,4248686417,1910131661,3267529648,3059746241,1956483636,775246236,3417697311,3894077015,3135702772 },
			{ 1642640414,4224628557,2967117588,796402983,3246732010,1214303894,2827198677,2165675667,3546463014,676315492,4079823036,1482829272,431921057,2222207109,1824318058,1078838587 },
			{ 4093661130,3000887149,3611936871,2032328089,432510459,215898269,2847400641,2953229601,1372335026,520367525,2338624325,3584629911,779829882,2135111988,3407617071,3880455472 },
			{ 3733805965,456168466,4021062731,551203316,4245718701,338740061,3757025042,1146401566,705530332,642590117,2100752047,3819868098,2545212872,3756686399,2795192428,1820352873 },
			{ 398887685,3850420668,924576678,1845334295,4249426603,692779843,3073893091,4048472560,1141919606,1345405165,1667484832,1512283676,2675841746,2508030674,3678475740,1339110625 },
			{ 458869337,1316931227,4000291494,4279340222,3047452102,3424124672,1455077812,2683516900,2010970124,2277330354,2843689938,2802064669,3746001786,3327648862,1111367397,1447879733 },
			{ 705831778,4263310823,718895363,2885182607,1062788183,3484138628,1676205482,4082910413,653390784,3645989404,755800334,2983596253,2532979681,2319949445,1843998035,4116743581 },
			{ 195013233,56051555,3122304594,3792121567,2545695628,2665841394,1989357190,3627291471,864442453,2733714964,687060641,1705027626,2466483021,2323455192,467579663,2676353736 },
			{ 3867026658,2556727701,137349711,3181974803,4109510444,2377490133,832434058,1190506380,3705154649,2585024060,1635890562,3555546855,1423099270,2893846654,3084300350,3903970971 },
			{ 3303971108,1244485225,2370830891,3836391255,92583147,3031135943,1159469251,319233366,2340336908,8784275,3599180127,1953837950,1873215085,243925913,2521761233,2719201572 },
			{ 1218599099,4227827310,1139279720,1210363104,2607818709,3557468099,820258370,231138332,1886718494,3564065388,3173164192,3967654034,3760954200,3003634555,3728079860,201038334 },
			{ 3565064327,351345443,105681584,3148355780,1845000828,2503155452,2654104772,964251547,4266599777,2136760294,1592705096,795202221,621796988,4257160667,1871990712,4064747666 },
			{ 209177811,1127638065,549696602,1932973173,1861026125,543836764,3115954738,1935106232,1077737743,1603218262,123845260,1822513080,2793513904,1888248320,1706886071,1655219483 },
			{ 3258663681,2713337115,2945889210,2792954317,2789145351,848028023,1827216407,2601658286,707862621,3291245747,4127247718,2865800212,2737652076,1935125050,2802065093,318417788 },
			{ 1101329217,2754640404,564200484,3988512291,577941045,3916221153,3183451500,2122318982,456881541,1083736562,3480497480,1303431357,487051656,3183108849,2307999438,2434510093 },
			{ 1036395247,1456652129,635197192,351317366,355681318,3879234754,2228976154,684729137,4137617528,4155576012,3584454111,3416920112,2604970906,1009127431,22993025,3742933976 },
			{ 444011862,4066083829,1062882913,2347140819,4112807791,2160867591,3679329016,827398552,3058390566,4033086979,3322999306,3811858384,4105479535,1923367043,3219657625,1714058412 },
			{ 39657439,2011174930,1540770659,2328498220,3411003886,1995729304,1847130287,1244580779,1713865750,70510355,4004652458,4194731836,1837536815,2022214451,408243467,2027523398 },
			{ 1893688495,888811576,1235194112,3107901724,3171353854,1354568588,2787046816,3390596909,4062241010,1564557130,2764365095,3745824528,1821069148,1633444174,3180101334,2356095273 },
			{ 2834859815,1626160120,2259540455,1669443167,198135837,3077027254,1939946934,3482453310,2185831386,1240542028,804797256,2797329249,3853391429,3219584234,2474949420,3676422391 },
			{ 171650822,806526918,2025240416,794853359,3783788492,1931041976,1014219372,1471905244,2684897890,4259427806,2279174889,3212958240,4202230391,2006683155,1341635794,1886682778 },
			{ 2880898415,1313180660,4220143274,574979331,1854954258,1027104339,1269250404,3309740553,2486395324,3015816631,2778410382,2631407459,399640205,1608423867,1012085581,1435435935 },
			{ 1308265502,1446125069,2797479064,64845725,62776754,117119722,3791429168,4082463294,704446354,1778687912,392738890,967357887,3041410450,3018915474,3966679612,3704281788 },
			{ 2801154208,2676198561,1102219750,2708026271,3763929018,2788268231,3109131516,2047746262,4233779307,2776153921,447141018,1064369908,478878837,3467492916,82158331,2154881851 },
			{ 4253075847,2867063141,343796788,3337930324,2193439384,3557052746,3855921222,1723903260,3993766821,1819035063,2984308184,2152340519,3555059968,4283968731,673429033,2427853198 },
			{ 3890253159,3198728595,965231116,1118534160,3147379440,2521446818,853474667,1323591440,1618993152,248346253,1549847178,163711992,2079574923,3704688672,1305437908,4111825663 },
			{ 1825153745,121811363,1272800824,3063213793,442707002,3344211597,110054737,1635805323,508625307,3816418600,759707531,3395628039,2853175414,4132584543,1876707184,1360921203 },
			{ 559368381,2958699051,535118182,2117302167,3400486092,25504128,1703013424,3760232818,4170647467,917647311,1588180938,3781570812,3892763406,1819257838,2792297488,3045416997 },
			{ 4076676518,381379213,133381853,3371282779,1864637792,862952323,4270650555,3959631359,1779075555,1218016786,3615304085,3531069163,2206888487,3582007287,1096237822,930712929 },
			{ 3848434056,1556445500,1783207904,1680549195,2148640292,2210347668,3597380469,2097209044,766969792,686826822,2152374325,4219988995,1768632769,3024654970,2763756146,1072722763 },
			{ 3952598610,74010617,4060910975,785201897,3507909713,488009024,1831083987,3053855490,4247411418,875519815,3856900659,3367738517,3242756864,15272980,3601343469,258074263 },
			{ 1323457343,1504545632,1624518447,1920975992,1604288882,1863148473,2737430287,2930836016,917524147,541947151,3282480426,4230464565,3583724686,4217506151,1935462189,1145335754 },
			{ 2723502630,79600266,3347118030,257714200,3678480656,4104639023,2025553564,1986330844,1117157276,2778819459,2145307578,4185530046,2464070426,1010413325,3575382639,3338876692 },
			{ 1040131296,3293929985,661832726,3816288012,570323424,3041536052,1493630531,2344353013,3324759860,4198080751,2374894999,1703275069,497237579,1842005227,1963637181,2099552420 },
			{ 730166312,487222288,3957393863,410202033,2391843265,996777889,2046520410,1543484087,3182706056,2148779540,145456287,3568034343,2137654168,3946814848,3664483797,1063846287 },
			{ 541140386,1490056137,50506996,1782350034,1161900646,3193874446,974091570,2462749987,1125785111,1365970243,3169056563,1557471716,3629576317,2835069322,2082182457,3924445379 },
			{ 3602262435,4145987290,1270349362,678951633,3959266064,4144427686,3459984434,1814469358,2041872935,2216898528,1626348440,63966235,3896128919,3704648649,2304452495,829678541 },
			{ 2748280488,1046678058,3261452132,3400105889,2390490521,3642668038,3260552164,194431558,830534751,2780965821,2662130899,724005366,3820392560,3977878579,3371080727,3314395762 },
			{ 2398672095,1576221883,441322172,57178261,3366195529,810889250,167454660,1888464151,1248470342,996660155,953635157,2733822458,3529268500,2407369610,3866921022,3631028213 },
			{ 2804829591,2220493564,3961037595,1241883108,2829184056,2831729703,276242918,1400335536,2112502150,3451562581,3630004419,344475290,351282647,3065989956,4065870944,1265221823 },
			{ 2522310963,439743419,2167327582,1623711046,369660673,4188070012,563603477,4124634802,790561078,747264173,2965880108,3350843626,2000938781,1208990577,3320907129,762783672 },
			{ 3258510297,3330946075,2157151390,3738059805,2614656731,3867089544,3716344285,3340334063,3871594439,930652399,1977557171,2756804989,3914099123,3870326299,1995237027,4228853572 },
			{ 3548230882,2013941493,1028683981,1518019155,3982277891,771755208,4121758383,240830387,2249149602,1644707283,98011919,3401359198,340217887,2880185145,2387596043,3851213121 },
			{ 1910083349,3369576576,3003209370,1825813318,3677351311,3361932979,2408829745,498410750,2213643072,110966950,367520884,1141521758,3068580116,2307762944,580076235,417132630 },
			{ 3107628400,3377168429,2571254374,3260832896,1257906576,777690983,876053117,2840620850,1389960256,533191812,2018656526,551058325,1212367853,1584011346,3375991813,4273283751 },
			{ 2460683794,2518061898,281845496,3728627818,2517720916,652975795,192987402,912519495,89606973,1928115893,4192958942,3573243300,164942023,4050485116,2495642532,710135350 },
			{ 1544338392,1532752920,2865029370,1310636833,572215535,3484230393,1840754295,1434518387,1942885814,2827783857,3820531456,2339493339,3965227244,4256656404,2243783484,3869235526 },
			{ 2307351863,2831930958,1619991417,2809127096,3635944956,3566114352,341348188,596806999,3965239340,2186521355,2993293269,1493084601,3383357176,2188414563,1041321093,1118484792 },
			{ 1232737635,2302621231,2076764882,3341896894,3794372994,2805252496,4255763160,3786844719,3197214650,2308797887,3778726879,1129609288,1508361450,2212962071,230630047,3049932928 },
			{ 15039748,2902800409,38940952,1287093099,163288054,229164576,3565751838,2561623081,3282145115,2433982533,2966170485,756580596,1207530995,1152965153,2352143095,1832282659 },
			{ 2260881273,1246189578,1956608604,2500348939,2281956994,1419636587,2177002482,1834114402,221508392,2016232376,1615642613,3012099009,1685089733,3680447380,990683676,2250531530 },
			{ 523766041,872348946,819101030,3026682404,1782767733,769296466,766417178,508106891,705660982,2127253036,1882288108,1153027435,1499894417,3841243098,2617768973,2219447107 },
			{ 1289704101,3066315998,240363246,3851066539,2746281849,3574432198,444703008,2976091445,894528242,1965662480,3580157640,3608362935,2523639526,1112872578,86739484,2230103574 },
			{ 2320782637,2050220548,2773500515,1658291041,4190050461,3402275657,3070564964,975576594,2728979332,1552099804,819182907,2459225575,2257733781,2201163224,1903002442,1015609246 },
			{ 1114038856,3010547157,4024235871,683897990,248413829,640624667,1790535143,199901523,1530705971,2795253327,1313866715,1308664927,3449034220,1070355371,3558346704,3867654697 },
			{ 3217828621,255339738,2215731965,2135639175,2720268042,3795144290,1796837802,3000271172,3476367237,701588027,979439214,1632222112,3129873444,3920317992,204990223,171547675 },
			{ 1569410670,2822745034,3866606229,2025503152,1988956371,2108511579,927817135,372107104,1691449829,1685873407,1826754535,3166495859,4206185217,4237306833,2639797327,2003347409 },
			{ 1796230635,4068222594,3749842422,3707415616,3227584526,4007519247,1752235424,1799441437,3503995806,2156320413,750053347,2139115678,3952743536,2244672328,355645414,1387567471 },
			{ 3347511199,1167166927,403650512,2122619873,3672026685,3284466452,2811512471,2126620388,1462355862,1937231655,764538250,3434143834,4164202645,1716056238,447583538,712605773 },
			{ 3053119138,2002898930,1953253460,596542052,945659164,891920096,1857646977,3314262207,3356913488,4045563223,230165313,1798521937,2011512309,2185787243,3108508656,3430158416 },
			{ 2054698149,3172702598,388061205,2387669355,455472912,3608425770,3745694987,71987328,1396225422,1450669353,2702049861,1180482850,2451172606,1580341636,203292496,4030309367 },
			{ 1483668143,4114479042,694625835,4103780838,2623682794,2392494897,3742999634,3768832159,3188143415,4229175989,3514152558,2776364761,3964118120,963391064,4088218787,3281383655 },
			{ 3499816722,1495447391,2802722270,722971555,3023278613,754857415,104664351,1738850037,1946685959,2855548289,788267312,399748177,28544917,547527355,1497977145,1324097098 },
			{ 4161279597,1289128851,4117140925,1192624402,3146173666,1130853562,3514652872,3788003255,2913327947,3650429222,3091610346,2403224733,2591409603,1684781551,66544650,3645737003 },
			{ 264943150,2016675969,2683087508,3929835964,2323050099,1258159650,1763801022,985855086,2571868554,4028255360,703015533,847970321,3140954535,2253043299,849330104,128327505 },
			{ 4175991544,2276436864,3778780199,3884064172,1109360185,108325381,1163790787,786728678,1457700959,1954225516,3603574781,717950825,1058366478,743309657,3774368451,221581713 },
			{ 2417045362,2075770480,82074433,1757732455,2815930119,2028566663,3042632958,2067424898,3013935283,788031213,2827501201,4259465894,3065169246,3089904769,1777791674,2781986508 },
			{ 3925390100,3158296396,1901504172,3640347663,4197775791,1277336874,2858829406,3688338093,1091221518,1711048621,2947756174,2546834300,421496444,3136418485,684052178,2073264186 },
			{ 1051994235,2552041961,1260104003,1556641743,3945886291,322280653,1017337458,410896019,3313452840,1181831701,706050286,1527736499,2700692360,1593607473,1721633948,1944878810 },
			{ 588440223,1034761979,1621463496,2519811010,649688003,3093633571,925196273,661285159,655835416,297766264,3453394987,3449641400,4025654937,1621534005,2732819676,3016506554 },
			{ 623274565,858723992,920706957,1676667256,2258274096,2650946105,3308344520,3553363299,3214315984,4233482591,3713974940,3347596045,3853866026,378780112,390525219,462811561 },
			{ 1663838855,3196594832,1837644235,1374050286,2233613782,3993138189,1709160265,2296274951,1794494227,614234079,2597452411,39111775,4097814364,2718732037,1886268603,3496267501 },
			{ 1006976202,360210952,1122422034,1542202661,4215312908,428189375,327324760,2986368829,3355624406,1345855142,2684316834,1452973800,4063395438,1098457357,3307243510,2988194098 },
			{ 1854883269,317448086,3896726403,311972477,2704947620,2174264626,360653082,1936631131,110619670,1862955700,530371414,140535985,233117820,4022705168,2050489755,2237531038 },
			{ 1832078807,4023829518,3319847436,4122395770,2810249462,3203284148,2031748166,1672386901,2132391846,750983305,954807062,2085170509,372443208,676390120,2091934817,3691149409 },
			{ 1379967321,3972771006,3783566917,2089594315,720333223,673262539,769112794,3506514113,4990424,4076400267,1460291601,2963829546,3674958521,1999340400,1869368470,1063599153 },
			{ 2587833845,2495910872,1103686559,2349586979,3743097621,1248639827,1350353691,111072684,362374286,668416053,4142466517,1293525126,2126939662,2352578012,1349817376,51470771 },
			{ 1303188392,3813947677,4179225918,3121940288,3975603475,1557429731,841811285,769148719,681137291,2057761856,2223410044,1411307125,1416397873,1720650218,1495230163,242869965 },
			{ 3126018717,4039651903,4193747904,3738579531,59559320,1948284958,1464577997,1521220783,2403616049,318815085,1023069589,1280848161,3127823879,2706971742,857945626,651882415 },
			{ 850004888,1459153979,829652664,1880401581,3872170773,1591667040,3336416975,1474172857,301229834,1498697583,160054148,1230875348,7299097,3140848614,2563522382,2149215497 },
			{ 1646933132,3358762345,1853910005,1099363428,124995159,4229640862,2795570018,4195399349,166896365,2273987208,3196908637,333414178,3748575839,621583977,1277726807,504518828 },
			{ 510349713,4141896269,1099109771,2226940636,3756371262,3695238791,3145232140,737773658,1653422298,1487835694,156744748,2180825401,1163410935,128136155,3768006939,2328996495 },
			{ 1779599840,92835247,285872879,178899102,676601582,3162686675,1591428051,4268520720,3096105091,1912153041,1767312113,262287959,3609255412,750490329,2126844961,827830618 },
			{ 1114532601,3784850660,173127282,2054895447,2454001566,446174045,1937901492,4202638572,2134659732,3948349570,1817498643,1110378868,2940927347,2321391991,1818739955,826327560 },
			{ 1103339107,2573246958,2080691473,1656866276,407867194,4113121330,2924867581,3443597237,3411549772,1645227423,1968000266,1316951519,3804539078,1046611402,1373737522,155435730 },
			{ 502078852,2394737357,2300990523,2794026076,3119482024,938947694,3341467848,868829020,1506875432,2571440877,3903295851,3002000922,2309887417,4193490698,1444306297,1053366875 },
			{ 2826600603,1156806223,4128124360,3366661693,3751307732,3444556723,2581307693,4237324933,3911453362,1990776992,1958767053,682644640,129409156,1797182822,2225349616,4250705899 },
			{ 335056349,1998763620,3758649524,3734968769,3936911592,1395996595,2440459826,2502080045,1369216195,178959281,1546220151,2505043819,2528137183,4133689941,3866965436,1909436310 },
			{ 549727827,796540911,1703800510,2296163924,3651797995,3450490365,3923252815,675346797,3733318497,1696640602,791495946,475287649,2300219422,1287383807,2971996506,660786132 },
			{ 3546961944,1256565491,93953038,1382798017,2443884491,3293761928,1865821568,36090491,996854272,502576446,4004233373,3114174464,3034013434,1498626791,3957471249,1756986227 },
			{ 3649812749,559169321,176538094,97640295,465406946,3960326465,1206686497,4234303711,3754357159,3324250221,2126459640,3325693656,32308116,1680449379,2223466331,1355401200 },
			{ 2030178207,987482097,3705616914,3130676898,627007210,644748867,149043190,2857083910,2612863655,4140946217,1043200492,118087065,3049410677,3629081635,2688313398,3230063732 },
			{ 2684516774,3148506478,3312697756,2977863802,885291582,1450052393,2621681463,3383496149,1089987975,3236768125,1764926606,1439519061,2170488451,3225333927,3328042383,827258812 },
			{ 444893142,4194958958,4264095026,2964703829,2081623414,2945670005,4055098664,3194697808,1484659474,1089459182,3523089441,3224334551,769089134,1737755259,2147606995,748250707 },
			{ 4211420755,3313401820,3189257322,3512171671,4145594988,3694288159,3288178197,1864579987,3892461190,97142009,2458375836,2331641534,1242320709,3340069508,4206896467,3298705251 },
			{ 2821696918,3577806942,3169505258,988709157,2438872424,2854212854,870399525,2563149113,968466185,1212420444,852728908,431312936,1899653443,285471835,889224369,161356746 },
			{ 218887673,2181147408,7746643,87916716,2919261332,3184553030,2614394212,2483315371,405224006,119410114,1645862883,3660466316,2608949147,2515904220,3905036101,1996320990 },
			{ 1751728231,3218111879,189018129,4103902784,3395495979,2111435370,638912912,1546231284,2540830896,2609798082,3843525490,1243491784,2947154254,609910668,3522141961,3662372501 },
			{ 415559596,172463966,1979685056,2488089686,26804898,1675166671,1574839341,1716566405,1825462176,3748828666,3995119433,2483172859,3444959623,526344972,1492844312,1635879730 } };

		//choose which to use
		state = D.at(scenario);
		state_i = 0; //reset when choosing a new scenario
		saveStates(scenario);
	}
	else
	{
		state = m_stored_states[scenario];
		state_i = m_stored_state_is[scenario];
	}
}

void WELLFiveTwelve::saveStates(int scenario)
{
	m_stored_states[scenario] = state;
	m_stored_state_is[scenario] = state_i;
}